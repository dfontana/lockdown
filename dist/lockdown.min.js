#!/usr/bin/env node --no-warnings
define("filesystem",["require","exports","util"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=e("fs").promises;void 0===i&&((i=e("fs")).stat=r.promisify(i.stat),i.readdir=r.promisify(i.readdir),i.writeFile=r.promisify(i.writeFile),i.readFile=r.promisify(i.readFile),i.unlink=r.promisify(i.unlink)),t.default={stat:i.stat,readdir:i.readdir,writeFile:i.writeFile,readFile:i.readFile,unlink:i.unlink}}),define("encryption",["require","exports","crypto"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={hashB:32,saltB:16,ivB:16,tagB:16,alg:"aes-256-gcm",iter:75e4};function s(e,t){const s=t||r.randomBytes(i.saltB),n=r.pbkdf2Sync(e,s,i.iter,i.hashB,"sha512");return Buffer.concat([s,n])}t.encrypt=function(e,t){const n=s(t,void 0),a=n.slice(0,i.saltB),o=n.slice(i.saltB),c=r.randomBytes(i.ivB),u=r.createCipheriv(i.alg,o,c),l=Buffer.concat([u.update(e),u.final()]),d=u.getAuthTag();return Buffer.concat([a,c,d,l])},t.decrypt=function(e,t){const n=e.slice(0,i.saltB),a=e.slice(i.saltB,i.saltB+i.ivB),o=e.slice(i.saltB+i.ivB,i.saltB+i.ivB+i.tagB),c=e.slice(i.saltB+i.ivB+i.tagB),u=s(t,n).slice(i.saltB),l=r.createDecipheriv(i.alg,u,a);return l.setAuthTag(o),Buffer.concat([l.update(c),l.final()])}}),define("progress",["require","exports","chalk","readline"],function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.total=0,this.current=0,this.text="",this.bar_length=(process.stdout.columns||80)-20}init(e,t){this.total=e,this.text=t,this.update(this.current)}add(e){this.update(this.current+e)}update(e){this.current=e;const t=this.current/this.total;this.draw(t)}draw(e){const t=Math.trunc(e*this.bar_length),s=this.bar_length-t,n=this.get_bar(t,"â– ",r.default.cyan),a=this.get_bar(s,"â–¡"),o=(100*e).toFixed(0).padStart(3);i.clearLine(process.stdout,0),i.cursorTo(process.stdout,0,void 0),process.stdout.write(`${this.text}|${n}${a}|${o}% ${"100"===o?"\n":""}`)}get_bar(e,t,r=(e=>e)){let i="";for(let r=0;r<e;r++)i+=t;return r(i)}}}),define("encodeDir",["require","exports","filesystem","chalk","path","encryption","progress"],function(e,t,r,i,s,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=".cpt";async function c(e,t){return s.isAbsolute(e)||(e=s.join(process.cwd(),e)),await async function e(t,i,n){let a=await r.default.stat(t);if(a.isDirectory()){let a=await r.default.readdir(t);for(let r=0;r<a.length;r++){let o=s.join(t,a[r]);n=await e(o,i,n)}}else{let e=/((^|\/)\.\w+$)/g.test(t),r=s.extname(t)===o,a=!i&&r&&!e,c=i&&!r&&!e;(a||c)&&n.push(t)}return n}(e,t,[])}function u(e,t){return async function(s,n){const o=new a.default;let u=`   ${e?"Encrypting":"Decrypting"}`;try{const a=await c(s,e);if(0===a.length)throw`   No files to ${u.slice(3,10)}`;o.init(a.length,i.default.cyan(u)),await Promise.all(a.map(e=>(function(e,t,i){return r.default.readFile(e).then(r=>t(r,e)).then(e=>r.default.writeFile(...e)).then(()=>r.default.unlink(e)).then(i)})(e,t(n),async()=>o.add(1))))}catch(e){console.error("   "+i.default.red(e))}}}t.encryptDir=u(!0,e=>(function(t,r){return[r+o,n.encrypt(t,e)]})),t.decryptDir=u(!1,e=>(function(t,r){return[r.slice(0,-4),n.decrypt(t,e)]}))}),define("hiddenInput",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=e("readline").createInterface({input:process.stdin,output:process.stdout});r._writeToOutput=function(e){r.output.write(`[2K[200D${r.query}${r.line.length%2==1?"â–¡":"â– "}`)},t.default=function(e){return r.query=e||"Input: ",new Promise((e,t)=>{r.question(r.query,t=>{r.output.write("\n"),r.close(),e(t)})})}}),define("lockdown",["require","exports","commander","hiddenInput","chalk","encodeDir"],function(e,t,r,i,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.version("0.0.1").description("Lockdown File Vault System"),r.command("encrypt <directory>").alias("e").option("-p, --passwd <passwd>","Debug usage only.").description("AES256-Auth encrypts directory (or file)").action((e,t)=>{t.passwd?n.encryptDir(e,t.passwd):i.default("   Password: ").then(t=>{n.encryptDir(e,t)})}),r.command("decrypt <directory>").alias("d").option("-p, --passwd <passwd>","Debug usage only.").description("Decrypts directory (or file)").action((e,t)=>{t.passwd?n.decryptDir(e,t.passwd):i.default("   Password: ").then(t=>{n.decryptDir(e,t)})}),r.on("command:*",function(){console.error(s.default.red.bold(`  Invalid command: ${r.args.join(" ")}`)),r.outputHelp(),process.exit(1)}),process.argv.slice(2).length?r.parse(process.argv):(r.outputHelp(),process.exit(0))});